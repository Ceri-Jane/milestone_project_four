{% extends "base.html" %}
{% load static %}

{# Page-specific SEO overrides: custom title + meta tags #}

{% block meta_description %}
<meta name="description" content="Edit an existing entry and update notes, mood data, or emotion tags.">
{% endblock %}

{% block meta_keywords %}
<meta name="keywords" content="edit entry, update entry, emotion tags, regulate">
{% endblock %}

{% block title %}
<title>Regulate | Edit Entry</title>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/entry.css' %}">

<div class="form-wrapper">
    <div class="form-card">

        <!-- Entry Title -->
        <h1 class="form-title">Edit Entry</h1>

        <!-- Show original creation timestamp -->
        <p class="form-info">
            Entry created on:
            {{ entry.created_at|date:"l d F Y • H:i" }}
        </p>

        <form method="post">
            {% csrf_token %}

            {% if form.errors %}
                <div class="alert alert-danger" role="alert">
                    Please correct the errors below.
                </div>
            {% endif %}

            <!-- Mood Hue -->
            <label for="hue">Mood Hue</label>

            <!-- Live range label (matches Entry.mood bands) -->
            <p class="form-info small-text" id="hue-range-label" aria-live="polite">
                Current range:
            </p>

            <div class="hue-slider-wrapper">
                <input
                    type="range"
                    id="hue"
                    name="hue"
                    min="0"
                    max="100"
                    class="hue-slider"
                    value="{{ hue_value|default:50 }}"
                    aria-describedby="hue-hint hue-range-label"
                >
            </div>

            <p class="form-section-hint" id="hue-hint">
                Move the slider to pick a colour that matches how you feel.
            </p>

            <!-- Hue meaning -->
            <label for="hue_notes">What does this hue mean today? (optional)</label>
            <textarea
                id="hue_notes"
                name="hue_notes"
                rows="3"
                aria-describedby="hue-notes-hint"
            >{{ existing_hue_notes }}</textarea>
            <p class="form-section-hint" id="hue-notes-hint">
                Describe the feelings behind choosing this hue (optional).
            </p>

            <!-- Emotion Words -->
            <label for="emotion-search">Emotion Words (optional)</label>
            <p class="form-section-hint" id="emotion-search-hint">
                Start typing to filter the list, then tick any words that fit.
            </p>

            <div class="emotion-select-wrapper">

                <!-- Search bar -->
                <input
                    type="text"
                    id="emotion-search"
                    class="search-input"
                    aria-describedby="emotion-search-hint"
                    aria-label="Search emotion words"
                >

                <!-- Scrollable checkbox list -->
                <div class="emotion-list" id="emotion-list">
                    {% for word in emotions %}
                    <label class="emotion-item">
                        <input
                            type="checkbox"
                            name="emotion_words"
                            value="{{ word.word }}"
                            {% if word.word in selected_emotions %}checked{% endif %}
                        >
                        <span>{{ word.word }}</span>
                    </label>
                    {% endfor %}
                </div>

                <p class="emotion-helper">
                    Tick as many feelings as you like — this helps you spot patterns over time.<br>
                    You don’t have to pick any words if you don’t want to.
                </p>
            </div>

            <!-- Notes for the Day -->
            <label for="notes">Notes for the day (optional)</label>
            <textarea
                id="notes"
                name="notes"
                rows="4"
                class="notes-box"
                aria-describedby="notes-hint"
            >{{ existing_notes }}</textarea>
            <p class="form-section-hint" id="notes-hint">
                Add anything else you want to save for today (optional).
            </p>

            <!-- Save changes button -->
            <button type="submit" class="select-btn">Save changes</button>

            <!-- Back to entries link -->
            <div class="entry-actions justify-content-center">
                <a href="{% url 'my_entries' %}">Cancel and return to your entries</a>
            </div>
        </form>

    </div>
</div>

<script src="{% static 'js/entry.js' %}" defer></script>
{% endblock %}
