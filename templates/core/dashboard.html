{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="form-wrapper">
    <div class="form-card dashboard-card">

        <h1 class="form-title">Your Dashboard</h1>

        <p class="form-info">
            Choose what you’d like to do with Regulate today.
        </p>

        <hr>

        <!-- Add new entry -->
        <div class="entry-card">
            <p><strong>Add a New Entry</strong></p>
            <p>
                Capture how you’re feeling right now in a quick, low-pressure note.
            </p>

            <a href="{% url 'new_entry' %}"
               class="select-btn">
                Add New Entry
            </a>
        </div>

        <!-- Your entries -->
        <div class="entry-card">
            <p><strong>Your Entries</strong></p>
            <p>
                Browse, search, and revisit your previous notes without any calendar pressure.
            </p>

            <a href="{% url 'my_entries' %}"
               class="select-btn">
                Go to Your Entries
            </a>
        </div>

        <!-- Supportive phrases / quotes -->
        <div class="entry-card supportive-card">
            <p><strong>Supportive Phrases</strong></p>
            <p>
                Generate a gentle, validating phrase on days when you need
                a little extra support.
            </p>

            <!-- Quote display box -->
            <div id="supportive-quote-box" class="supportive-quote-box">
                <p id="supportive-quote-text">
                    Click the button below to generate a supportive phrase.
                </p>
                <p id="supportive-quote-author" class="form-info"></p>
            </div>

            <!-- Button -->
            <button
                id="generate-quote-btn"
                class="select-btn mt-2"
                type="button">
                Generate Supportive Phrase
            </button>
        </div>

        <!-- Regulate+ Free Trial / Subscription card -->
        <div class="entry-card regulate-plus-card">
            <p><strong>Regulate+</strong></p>

            {% if subscription %}
                {% if subscription.status == "trialing" %}
                    <p>
                        <strong>Your free trial is active.</strong>
                        You won’t be charged until your trial ends.
                    </p>

                    {% if subscription.trial_end %}
                        <p class="form-info">
                            Trial ends:
                            <strong>{{ subscription.trial_end|date:"D j M Y" }}</strong>
                        </p>
                    {% endif %}

                    <div class="text-center mt-3">
                        <a href="{% url 'billing_details' %}" class="select-btn">
                            Manage billing in Stripe
                        </a>
                    </div>

                {% elif subscription.status == "active" %}
                    <p>
                        <strong>Your Regulate+ subscription is active.</strong>
                    </p>

                    {% if subscription.current_period_end %}
                        <p class="form-info">
                            Next renewal:
                            <strong>{{ subscription.current_period_end|date:"D j M Y" }}</strong>
                        </p>
                    {% endif %}

                    <div class="text-center mt-3">
                        <a href="{% url 'billing_details' %}" class="select-btn">
                            Manage billing in Stripe
                        </a>
                    </div>

                {% else %}
                    <p>
                        Your Regulate+ plan isn’t currently active.
                    </p>
                    <p class="form-info">
                        You can restart your subscription any time (trial is only available once).
                    </p>

                    <a href="{% url 'start_subscription' %}" class="select-btn">
                        Restart Regulate+
                    </a>

                    <div class="text-center mt-3">
                        <a href="{% url 'billing_details' %}" class="select-btn">
                            Manage billing in Stripe
                        </a>
                    </div>
                {% endif %}

            {% else %}
                <p>
                    Try Regulate+ free for 5 days. We’ll ask for your card details on a
                    secure Stripe checkout page, but <strong>you won’t be charged until the trial ends</strong>.
                    You can cancel any time before then and you won’t be billed.
                </p>

                <p class="form-info">
                    This gives you space to see whether a paid version of Regulate
                    supports your routines — without any pressure.
                </p>

                <!-- Redirect to Stripe Checkout -->
                <a
                    id="start-trial-btn"
                    href="{% url 'start_trial' %}"
                    class="select-btn">
                    Start 5-Day Free Trial
                </a>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}
