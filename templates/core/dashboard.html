{# templates/core/dashboard.html #}

{% extends "base.html" %}
{% load static %}

{# Page-specific SEO overrides: custom title + meta tags #}

{% block meta_description %}
<meta name="description" content="Dashboard for viewing and managing entries in Regulate.">
{% endblock %}

{% block meta_keywords %}
<meta name="keywords" content="regulate dashboard, entries, emotion tracking, mood tracking, bpd, adhd">
{% endblock %}

{% block title %}
<title>Regulate | Dashboard</title>
{% endblock %}


{% block content %}
<div class="form-wrapper">
    <div class="form-card dashboard-card">

        {# -------------------------------------------------- #}
        {# SITE ANNOUNCEMENTS (from admin)                    #}
        {# -------------------------------------------------- #}
        {% if announcements %}
            {# -------------------------------------------------- #}
            {# Dismissible announcements (client-side)       #}
            {#                                                    #}
            {# - Close button dismisses the alert for this login   #}
            {# - Uses login_key (based on user.last_login)         #}
            {# - Stored in localStorage (see main.js)              #}
            {# -------------------------------------------------- #}
            <div class="mb-3" id="dashboard-announcements" data-login-key="{{ login_key|default:'' }}">
                {% for a in announcements %}
                    <div
                        class="alert alert-banner alert-dismissible fade show align-items-center"
                        role="alert"
                        data-announcement-id="{{ a.id }}"
                        data-announcement-updated="{{ a.updated_at|date:'c' }}"
                    >
                        {% if a.title %}
                            <strong>{{ a.title }}</strong><br>
                        {% endif %}
                        {{ a.message }}

                        {# NEW: Bootstrap close button (top-right) #}
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="alert"
                            aria-label="Close">
                        </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <h1 class="form-title">Your Dashboard</h1>

        <p class="form-info">
            Choose what you’d like to do with Regulate today.
        </p>

        <hr>

        <!-- Add new entry -->
        <div class="entry-card">
            <p><strong>Add a New Entry</strong></p>
            <p>
                Capture how you’re feeling right now in a quick, low-pressure note.
            </p>

            {% if is_free_locked %}
                <button class="select-btn is-disabled" disabled>
                    Entry limit reached
                </button>
                <p class="form-info small-text">
                    You’ve reached {{ free_entry_limit }} entries on the free plan.
                    You can still view your entries, but creating and editing is paused.
                </p>
            {% else %}
                <a href="{% url 'new_entry' %}" class="select-btn">
                    Add New Entry
                </a>
            {% endif %}
        </div>

        <!-- Your entries -->
        <div class="entry-card">
            <p><strong>Your Entries</strong></p>
            <p>
                Browse, search, and revisit your previous notes without any calendar pressure.
            </p>

            <a href="{% url 'my_entries' %}" class="select-btn">
                Go to Your Entries
            </a>
        </div>

        <!-- Supportive phrases / quotes -->
        <div class="entry-card supportive-card">
            <p><strong>Supportive Phrases</strong></p>
            <p>
                Generate a gentle, validating phrase on days when you need
                a little extra support.
            </p>

            <!-- Quote display box -->
            <div id="supportive-quote-box" class="supportive-quote-box">
                <p id="supportive-quote-text">
                    Click the button below to generate a supportive phrase.
                </p>
                <p id="supportive-quote-author" class="form-info"></p>
            </div>

            <!-- Button -->
            <button
                id="generate-quote-btn"
                class="select-btn mt-2"
                type="button">
                Generate Supportive Phrase
            </button>
        </div>

    </div>
</div>
{% endblock %}
